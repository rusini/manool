# .github/workflows/cross.yaml

name: Build on a FreeBSD VM

on:
  workflow_dispatch:
  push:
    branches: [ "test" ]

jobs:
  build:

    name: Build
    runs-on: ubuntu-22.04

    defaults:
      run:
        shell: bash

    steps:

    - name: Machine Information
      run: |
        lscpu; free -h; df -h .
    - name: System Information
      run: |
        date; uname -a; uptime; cat /etc/os-release; ls -C /boot || :
    - name: Context Information
      run: |
        tty || :; id; printf %s\\n "$SHELL"; printf %s\\n "$PATH"; pwd

    - name: Checkout
      uses: actions/checkout@v4

    - name: Build under FreeBSD
#      uses: vmactions/freebsd-vm@v1
#      with:
#        usesh: true
#        prepare: |
#          set -x
#          freebsd-version
#          pkg install -y gmake
#          gmake --version
#          clang++ --version
#        run: |
#          set -x
#          whoami
#          pwd
#          ls -lah
#          gmake -j3 run GCC=clang GXX=clang++ CFLAGS='-Wno-psabi -O3 -fno-stack-protector -fcf-protection=none' MARCH=
      uses: cross-platform-actions/action@v0.23.0
      with:
        operating_system: freebsd
        version: "14.0"
        run: |
          set -x
          freebsd-version
          pkg install -y gmake
          gmake --version
          clang++ --version
          :
          whoami
          pwd
          ls -lah
          gmake -j3 run GCC=clang GXX=clang++ CFLAGS='-Wno-psabi -O3 -fno-stack-protector -fcf-protection=none' MARCH=

    - name: Upload Results
      uses: actions/upload-artifact@v4
      with:
        name: build
        path: build
